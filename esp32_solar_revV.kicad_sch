(kicad_sch (version 20211014) (generator "ChatGPT")
  (paper "A4")
  (title_block
    (title "ESP32 Solar Power â€“ RevV")
    (date "2025-08-08")
    (comment 1 "CN3065 solar charge + VBAT -> Boost 5V -> ESP32, Boost 9V for motors, RS485, LoRa")
  )

  (lib_symbols
    (symbol "MyLib:ESP32-WROOM-32" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U1" (id 0))
      (property "Value" "ESP32-WROOM-32" (id 1))
    )
    (symbol "MyLib:CN3065" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U3" (id 0))
      (property "Value" "CN3065" (id 1))
    )
    (symbol "MyLib:DW01A_Protection" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U4" (id 0))
      (property "Value" "DW01A+8205A" (id 1))
    )
    (symbol "MyLib:LM393" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U5" (id 0))
      (property "Value" "LM393 (2x)" (id 1))
    )
    (symbol "MyLib:MT3608_Boost" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U6" (id 0))
      (property "Value" "Boost 5V (MT3608)" (id 1))
    )
    (symbol "MyLib:XL6009_Boost" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U7" (id 0))
      (property "Value" "Boost 9V (XL6009)" (id 1))
    )
    (symbol "MyLib:MAX485" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U8" (id 0))
      (property "Value" "MAX485" (id 1))
    )
    (symbol "MyLib:LoRa_Ra02" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U9" (id 0))
      (property "Value" "LoRa Ra-02 (SX1278)" (id 1))
    )
    (symbol "MyLib:L298N" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U10" (id 0))
      (property "Value" "L298N" (id 1))
    )
    (symbol "MyLib:L298N" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U11" (id 0))
      (property "Value" "L298N" (id 1))
    )
    (symbol "MyLib:USB-C_Power" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "J1" (id 0))
      (property "Value" "USB-C VBUS" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Jpv" (id 0))
      (property "Value" "PV Input" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Jbat" (id 0))
      (property "Value" "Battery" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Jrs" (id 0))
      (property "Value" "RS485 A/B" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Js9" (id 0))
      (property "Value" "Sensors 9V" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Jm1" (id 0))
      (property "Value" "Motor A" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Jm2" (id 0))
      (property "Value" "Motor B" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Jm3" (id 0))
      (property "Value" "Motor C" (id 1))
    )
    (symbol "MyLib:Terminal_2P" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "Jm4" (id 0))
      (property "Value" "Motor D" (id 1))
    )
    (symbol "MyLib:Schottky" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "D1" (id 0))
      (property "Value" "1N5819" (id 1))
    )
    (symbol "MyLib:TVS" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "D2" (id 0))
      (property "Value" "TVS 6.8V" (id 1))
    )
    (symbol "MyLib:AMS1117-3.3" (pin_names (offset 1.27)) (in_bom yes)
      (property "Reference" "U2" (id 0))
      (property "Value" "AMS1117-3.3" (id 1))
    )
  )

  (sheet_instances
    (path "/") (page 1)
  )

  ;; --- Global Nets (labels) ---
  (text "NETS: PV_IN, USB_VBUS, VIN_CN, VBAT, 5V_BUS, 9V_BUS, GND" (at 10 10))

  ;; --- Block: PV & Charger ---
  (symbol (lib_id "MyLib:Terminal_2P") (at 30 40) (unit 1)
    (property "Reference" "Jpv" (id 0) (at 30 38))
    (property "Value" "PV Input" (id 1) (at 30 42))
  )
  (symbol (lib_id "MyLib:Schottky") (at 40 40)
    (property "Reference" "D1" (id 0) (at 40 38))
    (property "Value" "1N5819" (id 1) (at 40 42))
  )
  (symbol (lib_id "MyLib:TVS") (at 45 44)
    (property "Reference" "D2" (id 0) (at 45 42))
    (property "Value" "TVS 6.8V" (id 1) (at 45 46))
  )
  (symbol (lib_id "MyLib:CN3065") (at 55 40)
    (property "Reference" "U3" (id 0) (at 55 38))
    (property "Value" "CN3065" (id 1) (at 55 42))
  )
  (symbol (lib_id "MyLib:DW01A_Protection") (at 70 40)
    (property "Reference" "U4" (id 0) (at 70 38))
    (property "Value" "DW01A+8205A" (id 1) (at 70 42))
  )

  (text "PV_IN -> D1 -> VIN_CN (CN3065 IN). TVS to GND on VIN_CN." (at 30 48))

  ;; Nets as labels (visual doc)
  (text "Label PV_IN at Jpv pin1; Label VIN_CN between D1 and U3; Label VBAT at U4 out; GND common." (at 30 52))

  ;; --- Block: Boost 5V + EN logic ---
  (symbol (lib_id "MyLib:LM393") (at 55 25)
    (property "Reference" "U5" (id 0) (at 55 23))
    (property "Value" "LM393" (id 1) (at 55 27))
  )
  (text "Comparator1: USB_VBUS > 4.7V -> EN low; Comparator2: VBAT > 3.0V -> EN high; combine -> EN Boost5" (at 30 20))

  (symbol (lib_id "MyLib:MT3608_Boost") (at 70 25)
    (property "Reference" "U6" (id 0) (at 70 23))
    (property "Value" "Boost 5V (MT3608)" (id 1) (at 70 27))
  )
  (text "VBAT -> Boost5 -> 5V_BUS" (at 70 20))

  ;; --- Block: ESP32 + 3V3 LDO ---
  (symbol (lib_id "MyLib:ESP32-WROOM-32") (at 30 15)
    (property "Reference" "U1" (id 0) (at 30 13))
    (property "Value" "ESP32-WROOM-32" (id 1) (at 30 17))
  )
  (symbol (lib_id "MyLib:AMS1117-3.3") (at 20 18)
    (property "Reference" "U2" (id 0) (at 20 16))
    (property "Value" "AMS1117-3.3" (id 1) (at 20 20))
  )
  (text "5V_BUS -> LDO 3V3 -> ESP32 VCC; ESP32 VIN can also take 5V_BUS if using DevKit" (at 15 22))

  ;; --- Block: Boost 9V ---
  (symbol (lib_id "MyLib:XL6009_Boost") (at 85 25)
    (property "Reference" "U7" (id 0) (at 85 23))
    (property "Value" "Boost 9V (XL6009)" (id 1) (at 85 27))
  )
  (text "5V_BUS -> Boost9 -> 9V_BUS (EN from ESP32 GPIO)" (at 80 20))

  ;; --- Block: Motors ---
  (symbol (lib_id "MyLib:L298N") (at 85 40)
    (property "Reference" "U10" (id 0) (at 85 38))
    (property "Value" "L298N" (id 1) (at 85 42))
  )
  (symbol (lib_id "MyLib:L298N") (at 85 50)
    (property "Reference" "U11" (id 0) (at 85 48))
    (property "Value" "L298N" (id 1) (at 85 52))
  )
  (symbol (lib_id "MyLib:Terminal_2P") (at 100 40)
    (property "Reference" "Jm1" (id 0) (at 100 38))
    (property "Value" "Motor A" (id 1) (at 100 42))
  )
  (symbol (lib_id "MyLib:Terminal_2P") (at 100 43)
    (property "Reference" "Jm2" (id 0) (at 100 41))
    (property "Value" "Motor B" (id 1) (at 100 45))
  )
  (symbol (lib_id "MyLib:Terminal_2P") (at 100 50)
    (property "Reference" "Jm3" (id 0) (at 100 48))
    (property "Value" "Motor C" (id 1) (at 100 52))
  )
  (symbol (lib_id "MyLib:Terminal_2P") (at 100 53)
    (property "Reference" "Jm4" (id 0) (at 100 51))
    (property "Value" "Motor D" (id 1) (at 100 55))
  )
  (text "L298N VCC from 9V_BUS, logic from 5V/3V3 via level-compat if needed" (at 85 56))

  ;; --- Block: RS485 + Sensors 9V ---
  (symbol (lib_id "MyLib:MAX485") (at 60 15)
    (property "Reference" "U8" (id 0) (at 60 13))
    (property "Value" "MAX485" (id 1) (at 60 17))
  )
  (symbol (lib_id "MyLib:Terminal_2P") (at 75 15)
    (property "Reference" "Jrs" (id 0) (at 75 13))
    (property "Value" "RS485 A/B" (id 1) (at 75 17))
  )
  (symbol (lib_id "MyLib:Terminal_2P") (at 75 10)
    (property "Reference" "Js9" (id 0) (at 75 8))
    (property "Value" "Sensors 9V" (id 1) (at 75 12))
  )

  ;; --- Block: LoRa ---
  (symbol (lib_id "MyLib:LoRa_Ra02") (at 45 15)
    (property "Reference" "U9" (id 0) (at 45 13))
    (property "Value" "LoRa Ra-02 (SX1278)" (id 1) (at 45 17))
  )

  ;; --- Power nets as notes (you will see labels in KiCad) ---
  (text "Global labels to create in KiCad: PV_IN, USB_VBUS, VIN_CN, VBAT, 5V_BUS, 9V_BUS, GND" (at 20 60))
)
